!function(){"use strict";function d(t,e){if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,o=t.length>>>0,i=e,a=0;a<o;a++)if(n=t[a],e.call(i,n,a,t))return n}var a,t;(t=a=a||{}).CREATE_OR_UPDATE="nodehtml-create-or-update",t.DELETE="nodehtml-delete";var r=(e.prototype.updateParams=function(t){var e=t.tpl,n=void 0===e?function(){return""}:e,o=(t.cssClass,t.halign),i=void 0===o?"center":o,a=t.valign,r=void 0===a?"center":a,s=t.halignBox,d=void 0===s?"center":s,l=t.valignBox,p=void 0===l?"center":l,u={top:-.5,left:-.5,center:0,right:.5,bottom:.5};this._align=[u[i],u[r],100*(u[d]-.5),100*(u[p]-.5)],this.tpl=n},e.prototype.updateData=function(t){try{this._node.innerHTML=this.tpl(t)}catch(t){console.error(t)}},e.prototype.getNode=function(){return this._node},e.prototype.updatePosition=function(t){this._renderPosition(t)},e.prototype.initStyles=function(t){this._node.style.position="absolute",t&&t.length&&this._node.classList.add(t)},e.prototype._renderPosition=function(t){var e=this._position,n=t.x+this._align[0]*t.w,o=t.y+this._align[1]*t.h;if(!e||e[0]!==n||e[1]!==o){this._position=[n,o];var i="translate("+this._align[2]+"%,"+this._align[3]+"%) translate("+n.toFixed(2)+"px,"+o.toFixed(2)+"px) ",a=this._node.style;a.webkitTransform=i,a.msTransform=i,a.transform=i}},e);function e(t,e){var n=t.node,o=t.position,i=void 0===o?null:o,a=t.data,r=void 0===a?null:a;this.updateParams(e),this._node=n,this.initStyles(e.cssClass),r&&this.updateData(r),i&&this.updatePosition(i)}var s=(n.prototype.addOrUpdateElem=function(t,e,n){void 0===n&&(n={});var o=this._elements[t];if(o)return o.updateParams(e),o.updateData(n.data),o.updatePosition(n.position),{label:o,isNew:!1};var i=document.createElement("div");return this._node.appendChild(i),this._elements[t]=new r({node:i,data:n.data,position:n.position},e),{label:this._elements[t],isNew:!0}},n.prototype.removeElemById=function(t){return!!this._elements[t]&&(this._node.removeChild(this._elements[t].getNode()),delete this._elements[t],!0)},n.prototype.updateElemPosition=function(t,e){var n=this._elements[t];n&&n.updatePosition(e)},n.prototype.updatePanZoom=function(t){var e=t.pan,n=t.zoom,o="translate("+e.x+"px,"+e.y+"px) scale("+n+")",i=this._node.style,a="top left";i.webkitTransform=o,i.msTransform=o,i.transform=o,i.webkitTransformOrigin=a,i.msTransformOrigin=a,i.transformOrigin=a},n);function n(t){this._node=t,this._elements={}}var i=(o.prototype.updateNodeLabel=function(t){var e=this;t.each(function(t){e.updateNode(t)})},o.prototype.attachEvents=function(t){var e=this;t.one("render",function(t){e.createNodesCyHandler(t),e.wrapCyHandler(t)}),t.on("add",this.addCyHandler),t.on("layoutstop",this.layoutstopHandler),t.on("remove",this.removeCyHandler),t.on("data",this.updateDataOrStyleCyHandler),t.on("style",this.updateDataOrStyleCyHandler),t.on("pan zoom",this.wrapCyHandler),t.on("position bounds",this.moveCyHandler)},o.prototype.updateNode=function(e){var t=d(this.params.slice().reverse(),function(t){return e.is(t.query)});if(t){var n=this.getNodePosition(e),o=this.labelContainer.addOrUpdateElem(e.id(),t,{position:n,data:e.data()}),i=o.label,a=o.isNew;this.triggerCreateOrUpdateEvent(e,i,n,a)}else this.labelContainer.removeElemById(e.id()),this.triggerDeleteEvent(e)},o.prototype.createLabelContainer=function(t){var e=t.container(),n=document.createElement("div"),o=e.querySelector("canvas"),i=e.querySelector("[class^='cy-node-html']");i&&o.parentNode.removeChild(i);var a=n.style;return a.position="absolute",a["z-index"]=10,a.width="500px",a["pointer-events"]="all",a.cursor="default",a.margin="0px",a.padding="0px",a.border="0px",a.outline="0px",a.outline="0px",o.parentNode.appendChild(n),new s(n)},o.prototype.triggerCreateOrUpdateEvent=function(t,e,n,o){var i={label:e,position:n,isNew:o};t.trigger(a.CREATE_OR_UPDATE,i)},o.prototype.triggerDeleteEvent=function(t){t.trigger(a.DELETE)},o.prototype.getNodePosition=function(t){return{w:t.width(),h:t.height(),x:t.position("x"),y:t.position("y")}},o);function o(t,e){var s=this;this.addCyHandler=function(t){var e=t.target,n=d(s.params.slice().reverse(),function(t){return e.is(t.query)});if(n){var o=s.getNodePosition(e),i=s.labelContainer.addOrUpdateElem(e.id(),n,{position:o,data:e.data()}),a=i.label,r=i.isNew;s.triggerCreateOrUpdateEvent(e,a,o,r)}},this.layoutstopHandler=function(t){var e=t.cy;s.params.forEach(function(t){e.elements(t.query).forEach(function(t){t.isNode()&&s.labelContainer.updateElemPosition(t.id(),s.getNodePosition(t))})})},this.removeCyHandler=function(t){s.labelContainer.removeElemById(t.target.id()),s.triggerDeleteEvent(t.target)},this.moveCyHandler=function(t){s.labelContainer.updateElemPosition(t.target.id(),s.getNodePosition(t.target))},this.updateDataOrStyleCyHandler=function(t){t.cy.destroyed()||s.updateNode(t.target)},this.createNodesCyHandler=function(t){var e=t.cy;s.params.forEach(function(a){e.elements(a.query).forEach(function(t){if(t.isNode()){var e=s.getNodePosition(t),n=s.labelContainer.addOrUpdateElem(t.id(),a,{position:e,data:t.data()}),o=n.label,i=n.isNew;s.triggerCreateOrUpdateEvent(t,o,e,i)}})})},this.wrapCyHandler=function(t){var e=t.cy;s.labelContainer.updatePanZoom({pan:e.pan(),zoom:e.zoom()})},this.params=e,this.labelContainer=this.createLabelContainer(t),this.attachEvents(t)}function l(t){t&&t("core","nodeHtmlLabel",function(t){return function(t,e){var n="cytoscape-node-html-label.instance",o=t.scratch(n);return o||(o=new i(t,e&&"object"==typeof e?e:[]),t.scratch(n,o),o)}(this,t)})}"undefined"!=typeof module&&module.exports?module.exports=function(t){l(t)}:"undefined"!=typeof define&&define.amd&&define("cytoscape-nodeHtmlLabel",function(){return l}),"undefined"!=typeof cytoscape&&l(cytoscape)}();